<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>CLAYSTUDIO Device Viewer</title>
<style>
  body {
    text-align: center;
    font-family: Arial, sans-serif;
  }
  h2 {
    margin-bottom: 5px;
  }
  #gallery img {
    margin: 5px;
    max-height: 500px;
    height: 100%; 
    width: auto;
  }
</style>
</head>
<body>

<h2>CLAY SYSTEM</h2>
<h3 id="title"></h3>
<p>
  <a id="detail" ></a>
</p>

<p>
  
  <a id="invValue" href="#" target="_blank"></a>
</p>

<div id="gallery"></div>
<br><br>
<h3 id="parts_title"></h3>
<div id="gallery-parts"></div>

<script>
// Get URL parameters
const params = new URLSearchParams(window.location.search);
const id = params.get("id") || "test"; // default ID
const path = params.get("path") || "/claystudio/images/device/"; // default path
const name = params.get("name") 
//const name = params.get("name") 
const noinv = params.get("noinv") 
const parts = params.get("parts") 
const detail = params.get("detail") 
const sn = params.get("sn") 
const type = params.get("type") 
const cost = params.get("cost") 

// Generate inv from id
let inv = id.slice(0, -2).replace("DEV", "INV");
let inv2 = "images/invoice/"+ inv +".jpg";

// Show ID in the header
document.getElementById('title').textContent = id.toUpperCase() +  ( name ? " -- " + name.toUpperCase() : "" ) + ( sn ? " ( S/N: " + sn.toUpperCase() + " )" : "" ) + ( type ? " -- " + type.toUpperCase()  : "" )  ;

// Show INV value
if (detail != null) {
// document.getElementById('detail').textContent = detail;
let cost_formatted = Number(cost).toLocaleString('id-ID'); 
document.getElementById('detail').innerHTML = detail.replace(/\n/g, "<br>") + ( cost ? ( detail ?  "<br><br>": "" )+"Cost: Rp " + cost_formatted : "" );
}


// Show INV value
if (noinv !== "1") {

  const linkElement = document.getElementById('invValue');
  linkElement.href = inv2;
  linkElement.target = "_self";
  linkElement.textContent = `( invoice : ${inv} )`;
}

// Number of images to try loading
const maxImages = 16;
const gallery = document.getElementById('gallery');

// Loop through and add images
for (let i = 1; i <= maxImages; i++) {
  const number = String(i).padStart(2, '0'); // 01, 02 ...
  const img = document.createElement('img');
  img.src = `${path}${id}_IMG${number}.jpg`;
  img.onerror = () => img.remove(); // hide if missing
  gallery.appendChild(img);
}

if (parts != null ) {
  document.getElementById('parts_title').textContent = "Device Parts";

  // Split by "//"
  const partsArray = parts.split("//");

  // Target gallery-parts div
  const partsDiv = document.getElementById('gallery-parts');

  // Create table
  const table = document.createElement('table');
  table.style.margin = "0 auto"; // center table
  table.style.borderCollapse = "collapse";


  // // Header row
  // const row = document.createElement('tr');
  // const header1 = document.createElement('td');
  // header1.innerHTML = "<h3>Image</h3><br>";
  // const header2 = document.createElement('td');
  // header2.innerHTML = "<h3>Device</h3><br>";
  // const header3 = document.createElement('td');
  // header3.innerHTML = "<h3>Cost</h3><br>";
  // const header4 = document.createElement('td');
  // header4.innerHTML = "<h3>Note</h3><br>";
  // row.appendChild(header1);
  // row.appendChild(header2);
  // row.appendChild(header3);
  // //row.appendChild(header4);
  // table.appendChild(row);



  partsArray.forEach(p => {
    const separator = " -- ";
    const separator2 = " ** ";
    const id_part = p.split(separator)[0].trim();
    const info_part = p.split(separator)[1];
    const name_part = info_part.split(separator2)[0].trim();
    const cost_part = info_part.split(separator2)[1].trim() ;
    const sn_part = info_part.split(separator2)[2].trim() ;
    const notes_part = info_part.split(separator2)[3].trim() ;

    // Create row
    const row = document.createElement('tr');

    // === Column 1: Image ===
    const imgCell = document.createElement('td');
    imgCell.style.textAlign = "right"; // right-justify image
    const img = document.createElement('img');
    img.src = path + id_part + "_IMG01.jpg";
    img.alt = id_part;
    img.style.maxHeight = "40px";  // constrain by height
    img.style.height = "100%";     // ensure scaling by height
    img.style.width = "auto";      // keep aspect ratio
    img.onerror = () => img.remove(); // hide if missing
    imgCell.appendChild(img);

    // === Column 2: Link ===
    const linkCell = document.createElement('td');
    linkCell.style.textAlign = "left"; 
    linkCell.style.verticalAlign = "middle";
    linkCell.style.paddingLeft = "12px"; // add gap here
    const el = document.createElement('a');
    //let cost_clean = cost_part ? cost_part.replace(/[^0-9.-]+/g,"") : "";
    el.href = "/claystudio/device.html?id=" + id_part +  "&name=" + name_part + "&cost=" + cost_part  + "&detail=" + notes_part + "&sn=" + sn_part ;
    el.textContent = name_part ;
    el.target = "_self";
    linkCell.appendChild(el);


   // // === Column 3: Notes ===
    const sn = document.createElement('td');  
    sn.style.textAlign = "left";
    sn.style.verticalAlign = "middle";
    sn.style.paddingLeft = "12px"; // add gap here
    sn.textContent = sn_part ? sn_part : "";
    sn.style.minWidth = "60px";


    // // === Column 4: Notes ===
    const notes = document.createElement('td');  
    notes.style.textAlign = "left";
    notes.style.verticalAlign = "middle";
    notes.style.paddingLeft = "12px"; // add gap here
    notes.textContent = notes_part ? notes_part : "";
    notes.style.minWidth = "60px";


    // === Column 5: Cost ===
    const cost = document.createElement('td');
    cost.style.textAlign = "right";
    cost.style.verticalAlign = "middle";
    cost.style.paddingLeft = "12px"; // add gap here
    if (info_part.split(separator2)[1]) {
      let cost_value = info_part.split(separator2)[1].replace(/[^0-9.-]+/g,""); // extract numeric value
      let cost_formatted = Number(cost_value).toLocaleString('id-ID'); 
      cost.textContent = "Rp " + cost_formatted ;
    } else {
      cost.textContent = "-";
    }
    //cost.textContent = cost_part ? ("Rp " + Number(cost_part.replace(/[^0-9.-]+/g,"")).toLocaleString('id-ID')) : "-";



    // Append cells to row
    row.appendChild(imgCell);
    row.appendChild(linkCell);
    row.appendChild(sn);
    row.appendChild(notes);
    row.appendChild(cost);


    row.style.borderBottom = "1px solid #ccc"; // add bottom border to row
    row.style.padding = "8px 0"; // add vertical padding to row
    row.style.height = "60px"; // set row height
    row.style.fontSize = "14px"; // set font size
    row.style.fontFamily = "Arial, sans-serif"; // set font family

    // Add row to table
    table.appendChild(row);
  });

  // Add table to gallery-parts div
  partsDiv.appendChild(table);
}




</script>

</body>
</html>
